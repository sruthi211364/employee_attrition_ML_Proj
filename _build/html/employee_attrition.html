
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Employee Attrition Prediction &#8212; Employee Attrition Prediction</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'employee_attrition';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Anchula Lakshmi Sruthi" href="resume.html" />
    <link rel="prev" title="Introduction" href="markdown.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Employee Attrition Prediction - Home"/>
    <img src="_static/logo.png" class="logo__image only-dark pst-js-only" alt="Employee Attrition Prediction - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="markdown.html">Introduction</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Employee Attrition Prediction</a></li>












<li class="toctree-l1"><a class="reference internal" href="resume.html">Anchula Lakshmi Sruthi</a></li>
<li class="toctree-l1"><a class="reference internal" href="resume.html">Anchula Lakshmi Sruthi</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Femployee_attrition.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/employee_attrition.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Employee Attrition Prediction</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Employee Attrition Prediction</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-creating-a-normalized-database-3nf-using-sqlite"><strong>STEP 1: Creating a Normalized Database (3NF) using SQLITE</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-exploring-the-data-train-test-split"><strong>STEP 2: Exploring the data, train test split</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-exploring-the-data-and-performing-analysis"><strong>STEP 3: Exploring the data and performing analysis</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-1-creating-a-pre-processing-for-scaling-and-predicting"><strong>EXPERIMENT 1 Creating a pre-processing for scaling and predicting</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-2-preprocessing-and-using-multiple-algorithms"><strong>EXPERIMENT 2: Preprocessing and Using Multiple Algorithms</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-3-feature-engineering-and-attribute-combination"><strong>Experiment 3: feature engineering and attribute combination.</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-4-feature-selection-feature-importance-variance-threshold"><strong>EXPERIMENT 4: Feature Selection, Feature Importance, Variance Threshold</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-5-applying-pca"><strong>EXPERIMENT 5: Applying PCA</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-6-creating-a-custom-experiment"><strong>EXPERIMENT 6: Creating a custom experiment</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-7-another-custom-experiment"><strong>EXPERIMENT 7: Another custom experiment</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#step-8-f1-scores-of-all-models"><strong>STEP 8: F1 Scores of all models</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#step-9-creation-of-fastapi-for-model-and-streamlit-app"><strong>Step 9: Creation of FastAPI for model and Streamlit APP</strong></a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="employee-attrition-prediction">
<h1>Employee Attrition Prediction<a class="headerlink" href="#employee-attrition-prediction" title="Link to this heading">#</a></h1>
<p>Based on the employees survey questions, predictiing whether the employee has any intentions to leave the company or not. Checking their satisfactions.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="step-1-creating-a-normalized-database-3nf-using-sqlite">
<h1><strong>STEP 1: Creating a Normalized Database (3NF) using SQLITE</strong><a class="headerlink" href="#step-1-creating-a-normalized-database-3nf-using-sqlite" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Installing all the required libraries.</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="c1">#import matplotlib.pyplot as plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">bokeh</span> <span class="k">as</span> <span class="nn">bk</span>

<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats</span> <span class="kn">import</span> <span class="n">weightstats</span> <span class="k">as</span> <span class="n">stests</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">chi2_contingency</span>

<span class="c1"># Use a non-interactive backend</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="c1">#from ydata_profiling import ProfileReport</span>

<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">preprocessing</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">Normalizer</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">RobustScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">imblearn.combine</span> <span class="kn">import</span> <span class="n">SMOTETomek</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">tree</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">StackingClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">RandomizedSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">KFold</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span><span class="n">roc_auc_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_curve</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">ConfusionMatrixDisplay</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Now creating a normalized 3nf database using employee attrition data.</span>

<span class="c1"># Now loading the dataset into the database by creating a 3nf tables.</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;C:/Users/anchu/ML_Project_Python/datasets/employee_attrition.csv&quot;</span>
<span class="n">employee_attrition_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

<span class="c1"># Establish a connection to SQLite and create a database</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;employee_attrition.db&quot;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="c1">#Now creating a cursor using a connection that is established.</span>

<span class="c1"># Now creating the tables based on the similarities of the columns.</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE TABLE IF NOT EXISTS Education (</span>
<span class="s2">    EducationFieldID INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s2">    EducationField TEXT NOT NULL</span>
<span class="s2">);</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE TABLE IF NOT EXISTS MaritalStatus (</span>
<span class="s2">    MaritalStatusID INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s2">    MaritalStatus TEXT NOT NULL</span>
<span class="s2">);</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE TABLE IF NOT EXISTS Job (</span>
<span class="s2">    JobRoleID INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s2">    JobRole TEXT NOT NULL,</span>
<span class="s2">    Department TEXT NOT NULL,</span>
<span class="s2">    JobLevel INTEGER NOT NULL</span>
<span class="s2">);</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE TABLE IF NOT EXISTS Employee (</span>
<span class="s2">    EmployeeID INTEGER PRIMARY KEY,</span>
<span class="s2">    Age INTEGER NOT NULL,</span>
<span class="s2">    Gender TEXT NOT NULL,</span>
<span class="s2">    DistanceFromHome INTEGER NOT NULL,</span>
<span class="s2">    EducationFieldID INTEGER NOT NULL,</span>
<span class="s2">    MaritalStatusID INTEGER NOT NULL,</span>
<span class="s2">    JobRoleID INTEGER NOT NULL,</span>
<span class="s2">    FOREIGN KEY (EducationFieldID) REFERENCES Education(EducationFieldID),</span>
<span class="s2">    FOREIGN KEY (MaritalStatusID) REFERENCES MaritalStatus(MaritalStatusID),</span>
<span class="s2">    FOREIGN KEY (JobRoleID) REFERENCES Job(JobRoleID)</span>
<span class="s2">);</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE TABLE IF NOT EXISTS EmployeeMetrics (</span>
<span class="s2">    MetricID INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s2">    EmployeeID INTEGER NOT NULL,</span>
<span class="s2">    EnvironmentSatisfaction INTEGER NOT NULL,</span>
<span class="s2">    JobSatisfaction INTEGER NOT NULL,</span>
<span class="s2">    WorkLifeBalance INTEGER NOT NULL,</span>
<span class="s2">    StockOptionLevel INTEGER NOT NULL,</span>
<span class="s2">    TotalWorkingYears INTEGER NOT NULL,</span>
<span class="s2">    YearsAtCompany INTEGER NOT NULL,</span>
<span class="s2">    YearsInCurrentRole INTEGER NOT NULL,</span>
<span class="s2">    NumCompaniesWorked INTEGER NOT NULL,</span>
<span class="s2">    PercentSalaryHike INTEGER NOT NULL,</span>
<span class="s2">    DailyRate REAL NOT NULL,</span>
<span class="s2">    MonthlyIncome REAL NOT NULL,</span>
<span class="s2">    FOREIGN KEY (EmployeeID) REFERENCES Employee(EmployeeID)</span>
<span class="s2">);</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE TABLE IF NOT EXISTS Attrition (</span>
<span class="s2">    AttritionID INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s2">    EmployeeID INTEGER NOT NULL,</span>
<span class="s2">    Attrition TEXT NOT NULL,</span>
<span class="s2">    FOREIGN KEY (EmployeeID) REFERENCES Employee(EmployeeID)</span>
<span class="s2">);</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="c1"># Insert unique values into lookup tables</span>
<span class="n">education_fields</span> <span class="o">=</span> <span class="n">employee_attrition_data</span><span class="p">[</span><span class="s1">&#39;EducationField&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">marital_statuses</span> <span class="o">=</span> <span class="n">employee_attrition_data</span><span class="p">[</span><span class="s1">&#39;MaritalStatus&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">job_roles</span> <span class="o">=</span> <span class="n">employee_attrition_data</span><span class="p">[[</span><span class="s1">&#39;JobRole&#39;</span><span class="p">,</span> <span class="s1">&#39;Department&#39;</span><span class="p">,</span> <span class="s1">&#39;JobLevel&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="s2">&quot;INSERT INTO Education (EducationField) VALUES (?);&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="n">field</span><span class="p">,)</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">education_fields</span><span class="p">])</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="s2">&quot;INSERT INTO MaritalStatus (MaritalStatus) VALUES (?);&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="n">status</span><span class="p">,)</span> <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">marital_statuses</span><span class="p">])</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
    <span class="s2">&quot;INSERT INTO Job (JobRole, Department, JobLevel) VALUES (?, ?, ?);&quot;</span><span class="p">,</span>
    <span class="n">job_roles</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># Commit the changes</span>
<span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="c1"># Map lookup table IDs to the main dataset</span>
<span class="n">education_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM Education&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()}</span>
<span class="n">marital_status_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM MaritalStatus&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()}</span>
<span class="n">job_mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]):</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM Job&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1"># Prepare data for Employee table</span>
<span class="n">employee_data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;EmployeeNumber&#39;</span><span class="p">],</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">],</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Gender&#39;</span><span class="p">],</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;DistanceFromHome&#39;</span><span class="p">],</span>
        <span class="n">education_mapping</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;EducationField&#39;</span><span class="p">]],</span>
        <span class="n">marital_status_mapping</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;MaritalStatus&#39;</span><span class="p">]],</span>
        <span class="n">job_mapping</span><span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;JobRole&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Department&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;JobLevel&#39;</span><span class="p">])]</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">employee_attrition_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
<span class="p">]</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
    <span class="s2">&quot;INSERT INTO Employee (EmployeeID, Age, Gender, DistanceFromHome, EducationFieldID, MaritalStatusID, JobRoleID) VALUES (?, ?, ?, ?, ?, ?, ?);&quot;</span><span class="p">,</span>
    <span class="n">employee_data</span>
<span class="p">)</span>

<span class="c1"># Prepare data for EmployeeMetrics table</span>
<span class="n">employee_metrics_data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;EmployeeNumber&#39;</span><span class="p">],</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;EnvironmentSatisfaction&#39;</span><span class="p">],</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;JobSatisfaction&#39;</span><span class="p">],</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;WorkLifeBalance&#39;</span><span class="p">],</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;StockOptionLevel&#39;</span><span class="p">],</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;TotalWorkingYears&#39;</span><span class="p">],</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;YearsAtCompany&#39;</span><span class="p">],</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;YearsInCurrentRole&#39;</span><span class="p">],</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;NumCompaniesWorked&#39;</span><span class="p">],</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;PercentSalaryHike&#39;</span><span class="p">],</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;DailyRate&#39;</span><span class="p">],</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;MonthlyIncome&#39;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">employee_attrition_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
<span class="p">]</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
    <span class="s2">&quot;INSERT INTO EmployeeMetrics (EmployeeID, EnvironmentSatisfaction, JobSatisfaction, WorkLifeBalance, StockOptionLevel, TotalWorkingYears, YearsAtCompany, YearsInCurrentRole, NumCompaniesWorked, PercentSalaryHike, DailyRate, MonthlyIncome) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);&quot;</span><span class="p">,</span>
    <span class="n">employee_metrics_data</span>
<span class="p">)</span>

<span class="c1"># Prepare data for Attrition table</span>
<span class="n">attrition_data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;EmployeeNumber&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Attrition&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">employee_attrition_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
<span class="p">]</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
    <span class="s2">&quot;INSERT INTO Attrition (EmployeeID, Attrition) VALUES (?, ?);&quot;</span><span class="p">,</span>
    <span class="n">attrition_data</span>
<span class="p">)</span>

<span class="c1"># Commit all changes</span>
<span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Database populated successfully.&quot;</span><span class="p">)</span>

<span class="c1"># Close the connection</span>
<span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">IntegrityError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">115</span>
<span class="g g-Whitespace">    </span><span class="mi">101</span> <span class="c1"># Prepare data for Employee table</span>
<span class="g g-Whitespace">    </span><span class="mi">102</span> <span class="n">employee_data</span> <span class="o">=</span> <span class="p">[</span>
<span class="g g-Whitespace">    </span><span class="mi">103</span>     <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">104</span>         <span class="n">row</span><span class="p">[</span><span class="s1">&#39;EmployeeNumber&#39;</span><span class="p">],</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="nn">    112     for _, row</span> in <span class="ni">employee_attrition_data.iterrows</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">113</span> <span class="p">]</span>
<span class="ne">--&gt; </span><span class="mi">115</span> <span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">116</span>     <span class="s2">&quot;INSERT INTO Employee (EmployeeID, Age, Gender, DistanceFromHome, EducationFieldID, MaritalStatusID, JobRoleID) VALUES (?, ?, ?, ?, ?, ?, ?);&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">117</span>     <span class="n">employee_data</span>
<span class="g g-Whitespace">    </span><span class="mi">118</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">120</span> <span class="c1"># Prepare data for EmployeeMetrics table</span>
<span class="g g-Whitespace">    </span><span class="mi">121</span> <span class="n">employee_metrics_data</span> <span class="o">=</span> <span class="p">[</span>
<span class="g g-Whitespace">    </span><span class="mi">122</span>     <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">123</span>         <span class="n">row</span><span class="p">[</span><span class="s1">&#39;EmployeeNumber&#39;</span><span class="p">],</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="nn">    136     for _, row</span> in <span class="ni">employee_attrition_data.iterrows</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">137</span> <span class="p">]</span>

<span class="ne">IntegrityError</span>: UNIQUE constraint failed: Employee.EmployeeID
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Now the process is to develop the code to push all the data inside the multiple tables into the pandas dataframe.</span>

<span class="c1">#Now establishing the connection again by connecting it to the database file.</span>
<span class="n">conn_data</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;employee_attrition.db&quot;</span><span class="p">)</span>

<span class="c1">#Now implementing a query to to fetch data into the dataframe.</span>

<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT </span>
<span class="s2">    e.EmployeeID,</span>
<span class="s2">    e.Age,</span>
<span class="s2">    e.Gender,</span>
<span class="s2">    e.DistanceFromHome,</span>
<span class="s2">    ed.EducationField,</span>
<span class="s2">    ms.MaritalStatus,</span>
<span class="s2">    j.JobRole,</span>
<span class="s2">    j.Department,</span>
<span class="s2">    j.JobLevel,</span>
<span class="s2">    em.EnvironmentSatisfaction,</span>
<span class="s2">    em.JobSatisfaction,</span>
<span class="s2">    em.WorkLifeBalance,</span>
<span class="s2">    em.StockOptionLevel,</span>
<span class="s2">    em.TotalWorkingYears,</span>
<span class="s2">    em.YearsAtCompany,</span>
<span class="s2">    em.YearsInCurrentRole,</span>
<span class="s2">    em.NumCompaniesWorked,</span>
<span class="s2">    em.PercentSalaryHike,</span>
<span class="s2">    em.DailyRate,</span>
<span class="s2">    em.MonthlyIncome,</span>
<span class="s2">    a.Attrition</span>
<span class="s2">FROM Employee e</span>
<span class="s2">JOIN Education ed ON e.EducationFieldID = ed.EducationFieldID</span>
<span class="s2">JOIN MaritalStatus ms ON e.MaritalStatusID = ms.MaritalStatusID</span>
<span class="s2">JOIN Job j ON e.JobRoleID = j.JobRoleID</span>
<span class="s2">JOIN EmployeeMetrics em ON e.EmployeeID = em.EmployeeID</span>
<span class="s2">JOIN Attrition a ON e.EmployeeID = a.EmployeeID;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">conn_data</span><span class="p">)</span>

<span class="n">conn_data</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>EmployeeID</th>
      <th>Age</th>
      <th>Gender</th>
      <th>DistanceFromHome</th>
      <th>EducationField</th>
      <th>MaritalStatus</th>
      <th>JobRole</th>
      <th>Department</th>
      <th>JobLevel</th>
      <th>EnvironmentSatisfaction</th>
      <th>...</th>
      <th>WorkLifeBalance</th>
      <th>StockOptionLevel</th>
      <th>TotalWorkingYears</th>
      <th>YearsAtCompany</th>
      <th>YearsInCurrentRole</th>
      <th>NumCompaniesWorked</th>
      <th>PercentSalaryHike</th>
      <th>DailyRate</th>
      <th>MonthlyIncome</th>
      <th>Attrition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>41</td>
      <td>Female</td>
      <td>1</td>
      <td>Life Sciences</td>
      <td>Single</td>
      <td>Sales Executive</td>
      <td>Sales</td>
      <td>2</td>
      <td>2</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>8</td>
      <td>6</td>
      <td>4</td>
      <td>8</td>
      <td>11</td>
      <td>1102.0</td>
      <td>5993.0</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>49</td>
      <td>Male</td>
      <td>8</td>
      <td>Life Sciences</td>
      <td>Married</td>
      <td>Research Scientist</td>
      <td>Research &amp; Development</td>
      <td>2</td>
      <td>3</td>
      <td>...</td>
      <td>3</td>
      <td>1</td>
      <td>10</td>
      <td>10</td>
      <td>7</td>
      <td>1</td>
      <td>23</td>
      <td>279.0</td>
      <td>5130.0</td>
      <td>No</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>37</td>
      <td>Male</td>
      <td>2</td>
      <td>Other</td>
      <td>Single</td>
      <td>Laboratory Technician</td>
      <td>Research &amp; Development</td>
      <td>1</td>
      <td>4</td>
      <td>...</td>
      <td>3</td>
      <td>0</td>
      <td>7</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>15</td>
      <td>1373.0</td>
      <td>2090.0</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>3</th>
      <td>5</td>
      <td>33</td>
      <td>Female</td>
      <td>3</td>
      <td>Life Sciences</td>
      <td>Married</td>
      <td>Research Scientist</td>
      <td>Research &amp; Development</td>
      <td>1</td>
      <td>4</td>
      <td>...</td>
      <td>3</td>
      <td>0</td>
      <td>8</td>
      <td>8</td>
      <td>7</td>
      <td>1</td>
      <td>11</td>
      <td>1392.0</td>
      <td>2909.0</td>
      <td>No</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7</td>
      <td>27</td>
      <td>Male</td>
      <td>2</td>
      <td>Medical</td>
      <td>Married</td>
      <td>Laboratory Technician</td>
      <td>Research &amp; Development</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>3</td>
      <td>1</td>
      <td>6</td>
      <td>2</td>
      <td>2</td>
      <td>9</td>
      <td>12</td>
      <td>591.0</td>
      <td>3468.0</td>
      <td>No</td>
    </tr>
  </tbody>
</table>
<p>5 rows Ã— 21 columns</p>
</div></div></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="step-2-exploring-the-data-train-test-split">
<h1><strong>STEP 2: Exploring the data, train test split</strong><a class="headerlink" href="#step-2-exploring-the-data-train-test-split" title="Link to this heading">#</a></h1>
<p><strong>Now the process is to explore through the data and find out if the data needs to be stratified or not. After the process the data needs to be splitted into train and test sets</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Now checking for balency in the dataset for target feature</span>
<span class="n">Attrition_count</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Attrition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The count of attritions are&#39;</span><span class="p">,</span> <span class="n">Attrition_count</span><span class="p">)</span> <span class="c1">#by looking at the below outputs it tells that, the data is not balanced. So, the data needs to be stratified.</span>

<span class="n">Attrition_count</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Imbalanecy in the target feature&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Attirtion Value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The count of attritions are No     1233
Yes     237
Name: Attrition, dtype: int64
</pre></div>
</div>
<img alt="_images/ed039f30bfc1598510eca79bff06c6329fbb2d6719cc737257e57b303b4cfd25.png" src="_images/ed039f30bfc1598510eca79bff06c6329fbb2d6719cc737257e57b303b4cfd25.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Since the data is imbalanced, this can be done using train and test split</span>

<span class="c1">#Now dividing the data into x and y features, where y contains target outcome.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Attrition&#39;</span><span class="p">,</span> <span class="s1">&#39;EmployeeID&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Attrition&#39;</span><span class="p">]</span>

<span class="c1">#Now after dividing the data, it will now further be divided into train and test split.</span>
<span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">55</span><span class="p">)</span>

<span class="c1">#Now thus verifying the stratification to ensure the data is split equally.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training set stratification&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The testing set stratification&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training set stratification
No     986
Yes    190
Name: Attrition, dtype: int64
The testing set stratification
No     247
Yes     47
Name: Attrition, dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="step-3-exploring-the-data-and-performing-analysis">
<h1><strong>STEP 3: Exploring the data and performing analysis</strong><a class="headerlink" href="#step-3-exploring-the-data-and-performing-analysis" title="Link to this heading">#</a></h1>
<p><strong>Exploring using yprofile and performing co-relation matrix, performing cleaning, making observations, converting data columns into numerical ones.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Checking for datatypes and column names present in the dataset.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="c1">#now checking for null values inside the dataset.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>EmployeeID                   int64
Age                          int64
Gender                      object
DistanceFromHome             int64
EducationField              object
MaritalStatus               object
JobRole                     object
Department                  object
JobLevel                     int64
EnvironmentSatisfaction      int64
JobSatisfaction              int64
WorkLifeBalance              int64
StockOptionLevel             int64
TotalWorkingYears            int64
YearsAtCompany               int64
YearsInCurrentRole           int64
NumCompaniesWorked           int64
PercentSalaryHike            int64
DailyRate                  float64
MonthlyIncome              float64
Attrition                   object
dtype: object
Index([&#39;EmployeeID&#39;, &#39;Age&#39;, &#39;Gender&#39;, &#39;DistanceFromHome&#39;, &#39;EducationField&#39;,
       &#39;MaritalStatus&#39;, &#39;JobRole&#39;, &#39;Department&#39;, &#39;JobLevel&#39;,
       &#39;EnvironmentSatisfaction&#39;, &#39;JobSatisfaction&#39;, &#39;WorkLifeBalance&#39;,
       &#39;StockOptionLevel&#39;, &#39;TotalWorkingYears&#39;, &#39;YearsAtCompany&#39;,
       &#39;YearsInCurrentRole&#39;, &#39;NumCompaniesWorked&#39;, &#39;PercentSalaryHike&#39;,
       &#39;DailyRate&#39;, &#39;MonthlyIncome&#39;, &#39;Attrition&#39;],
      dtype=&#39;object&#39;)
EmployeeID                 0
Age                        0
Gender                     0
DistanceFromHome           0
EducationField             0
MaritalStatus              0
JobRole                    0
Department                 0
JobLevel                   0
EnvironmentSatisfaction    0
JobSatisfaction            0
WorkLifeBalance            0
StockOptionLevel           0
TotalWorkingYears          0
YearsAtCompany             0
YearsInCurrentRole         0
NumCompaniesWorked         0
PercentSalaryHike          0
DailyRate                  0
MonthlyIncome              0
Attrition                  0
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Now removing the unwanted employee id which is of no use.</span>
<span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;EmployeeID&#39;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Age</th>
      <th>Gender</th>
      <th>DistanceFromHome</th>
      <th>EducationField</th>
      <th>MaritalStatus</th>
      <th>JobRole</th>
      <th>Department</th>
      <th>JobLevel</th>
      <th>EnvironmentSatisfaction</th>
      <th>JobSatisfaction</th>
      <th>WorkLifeBalance</th>
      <th>StockOptionLevel</th>
      <th>TotalWorkingYears</th>
      <th>YearsAtCompany</th>
      <th>YearsInCurrentRole</th>
      <th>NumCompaniesWorked</th>
      <th>PercentSalaryHike</th>
      <th>DailyRate</th>
      <th>MonthlyIncome</th>
      <th>Attrition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>41</td>
      <td>Female</td>
      <td>1</td>
      <td>Life Sciences</td>
      <td>Single</td>
      <td>Sales Executive</td>
      <td>Sales</td>
      <td>2</td>
      <td>2</td>
      <td>4</td>
      <td>1</td>
      <td>0</td>
      <td>8</td>
      <td>6</td>
      <td>4</td>
      <td>8</td>
      <td>11</td>
      <td>1102.0</td>
      <td>5993.0</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>1</th>
      <td>49</td>
      <td>Male</td>
      <td>8</td>
      <td>Life Sciences</td>
      <td>Married</td>
      <td>Research Scientist</td>
      <td>Research &amp; Development</td>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>10</td>
      <td>10</td>
      <td>7</td>
      <td>1</td>
      <td>23</td>
      <td>279.0</td>
      <td>5130.0</td>
      <td>No</td>
    </tr>
    <tr>
      <th>2</th>
      <td>37</td>
      <td>Male</td>
      <td>2</td>
      <td>Other</td>
      <td>Single</td>
      <td>Laboratory Technician</td>
      <td>Research &amp; Development</td>
      <td>1</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>7</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>15</td>
      <td>1373.0</td>
      <td>2090.0</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>3</th>
      <td>33</td>
      <td>Female</td>
      <td>3</td>
      <td>Life Sciences</td>
      <td>Married</td>
      <td>Research Scientist</td>
      <td>Research &amp; Development</td>
      <td>1</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>8</td>
      <td>8</td>
      <td>7</td>
      <td>1</td>
      <td>11</td>
      <td>1392.0</td>
      <td>2909.0</td>
      <td>No</td>
    </tr>
    <tr>
      <th>4</th>
      <td>27</td>
      <td>Male</td>
      <td>2</td>
      <td>Medical</td>
      <td>Married</td>
      <td>Laboratory Technician</td>
      <td>Research &amp; Development</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>6</td>
      <td>2</td>
      <td>2</td>
      <td>9</td>
      <td>12</td>
      <td>591.0</td>
      <td>3468.0</td>
      <td>No</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Performing visualizations to get deeper insights about numerical, continous, nominal, and ordinal data.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">continous</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Age&#39;</span><span class="p">,</span><span class="s1">&#39;DailyRate&#39;</span><span class="p">,</span><span class="s1">&#39;MonthlyIncome&#39;</span><span class="p">,</span><span class="s1">&#39;PercentSalaryHike&#39;</span><span class="p">,</span><span class="s1">&#39;Attrition&#39;</span><span class="p">]</span> <span class="c1">#continous data column names</span>
<span class="n">nominal</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Department&#39;</span><span class="p">,</span><span class="s1">&#39;EducationField&#39;</span><span class="p">,</span><span class="s1">&#39;Gender&#39;</span><span class="p">,</span><span class="s1">&#39;JobRole&#39;</span><span class="p">,</span><span class="s1">&#39;Attrition&#39;</span><span class="p">]</span><span class="c1">#nominal data column names</span>
<span class="n">ordinal</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;EnvironmentSatisfaction&#39;</span><span class="p">,</span><span class="s1">&#39;JobLevel&#39;</span><span class="p">,</span><span class="s1">&#39;JobSatisfaction&#39;</span><span class="p">,</span>
         <span class="s1">&#39;WorkLifeBalance&#39;</span><span class="p">,</span><span class="s1">&#39;Attrition&#39;</span><span class="p">]</span> <span class="c1">#ordinal data column names</span>
<span class="n">other_cols</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;StockOptionLevel&#39;</span><span class="p">,</span><span class="s1">&#39;TotalWorkingYears&#39;</span><span class="p">,</span><span class="s1">&#39;YearsAtCompany&#39;</span><span class="p">,</span><span class="s1">&#39;YearsInCurrentRole&#39;</span><span class="p">,</span><span class="s1">&#39;Attrition&#39;</span><span class="p">]</span>


<span class="n">data_continous</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">data_continous</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;Age&#39;</span><span class="p">,</span><span class="s1">&#39;DailyRate&#39;</span><span class="p">,</span><span class="s1">&#39;MonthlyIncome&#39;</span><span class="p">,</span><span class="s1">&#39;PercentSalaryHike&#39;</span><span class="p">,</span><span class="s1">&#39;Attrition&#39;</span><span class="p">]]</span> <span class="c1">#extracting all the continous data</span>




<span class="n">data_nominal</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">data_nominal</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;Department&#39;</span><span class="p">,</span><span class="s1">&#39;EducationField&#39;</span><span class="p">,</span><span class="s1">&#39;Gender&#39;</span><span class="p">,</span><span class="s1">&#39;JobRole&#39;</span><span class="p">,</span><span class="s1">&#39;Attrition&#39;</span><span class="p">]]</span> <span class="c1"># extracting all nominal data</span>


<span class="n">data_ordinal</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">data_ordinal</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;EnvironmentSatisfaction&#39;</span><span class="p">,</span><span class="s1">&#39;JobLevel&#39;</span><span class="p">,</span><span class="s1">&#39;JobSatisfaction&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;WorkLifeBalance&#39;</span><span class="p">,</span><span class="s1">&#39;Attrition&#39;</span><span class="p">]]</span> <span class="c1">#extracting all ordinal data</span>


<span class="n">data_other_cols</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">data_other_cols</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;StockOptionLevel&#39;</span><span class="p">,</span><span class="s1">&#39;TotalWorkingYears&#39;</span><span class="p">,</span><span class="s1">&#39;YearsAtCompany&#39;</span><span class="p">,</span><span class="s1">&#39;YearsInCurrentRole&#39;</span><span class="p">,</span><span class="s1">&#39;Attrition&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Now exploring data through continous data</span>
<span class="n">data_continous</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Age</th>
      <th>DailyRate</th>
      <th>MonthlyIncome</th>
      <th>PercentSalaryHike</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1470.000000</td>
      <td>1470.000000</td>
      <td>1470.000000</td>
      <td>1470.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>36.923810</td>
      <td>802.485714</td>
      <td>6502.931293</td>
      <td>15.209524</td>
    </tr>
    <tr>
      <th>std</th>
      <td>9.135373</td>
      <td>403.509100</td>
      <td>4707.956783</td>
      <td>3.659938</td>
    </tr>
    <tr>
      <th>min</th>
      <td>18.000000</td>
      <td>102.000000</td>
      <td>1009.000000</td>
      <td>11.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>30.000000</td>
      <td>465.000000</td>
      <td>2911.000000</td>
      <td>12.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>36.000000</td>
      <td>802.000000</td>
      <td>4919.000000</td>
      <td>14.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>43.000000</td>
      <td>1157.000000</td>
      <td>8379.000000</td>
      <td>18.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>60.000000</td>
      <td>1499.000000</td>
      <td>19999.000000</td>
      <td>25.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now performing analysis for nominal data too to check for discrepencies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#performing co-relations among the several datasets</span>
<span class="n">nominal1</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Department&#39;</span><span class="p">,</span><span class="s1">&#39;EducationField&#39;</span><span class="p">,</span><span class="s1">&#39;Gender&#39;</span><span class="p">,</span><span class="s1">&#39;JobRole&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nominal1</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_nominal</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">hue</span><span class="o">=</span><span class="n">data_nominal</span><span class="p">[</span><span class="s1">&#39;Attrition&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 2500x1500 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/b638ee2d4443820c6170260ecb5287e835e0116232d09f2a7b1a782195ed8836.png" src="_images/b638ee2d4443820c6170260ecb5287e835e0116232d09f2a7b1a782195ed8836.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 2500x1500 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/f70496db3d492f79074ba683d991180cd9eecfeb9ab688a3ba79045e87b865fd.png" src="_images/f70496db3d492f79074ba683d991180cd9eecfeb9ab688a3ba79045e87b865fd.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 2500x1500 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/e1b596a7606e70656ac21b4cc14ae83d4a46135bdeeff8206ac35a0ca045f49a.png" src="_images/e1b596a7606e70656ac21b4cc14ae83d4a46135bdeeff8206ac35a0ca045f49a.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 2500x1500 with 0 Axes&gt;
</pre></div>
</div>
<img alt="_images/47e31ab738ea4984ca3f11521dc03460f9c69584d1920063423f42e184dfcb37.png" src="_images/47e31ab738ea4984ca3f11521dc03460f9c69584d1920063423f42e184dfcb37.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Now performing analysis for ordinal data to check for in-depth analysis and discrepencies.</span>
<span class="n">ordinal1</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;EnvironmentSatisfaction&#39;</span><span class="p">,</span><span class="s1">&#39;JobLevel&#39;</span><span class="p">,</span><span class="s1">&#39;JobSatisfaction&#39;</span><span class="p">,</span>
         <span class="s1">&#39;WorkLifeBalance&#39;</span><span class="p">]</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ordinal1</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data_ordinal</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">hue</span><span class="o">=</span><span class="n">data_ordinal</span><span class="p">[</span><span class="s1">&#39;Attrition&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d0128d28d3972207be9a00d8ed91cb17226b066aaa642eaacf9d96e9140d180b.png" src="_images/d0128d28d3972207be9a00d8ed91cb17226b066aaa642eaacf9d96e9140d180b.png" />
<img alt="_images/595e211a753e8eee39757b9217f3c68b1a4f23f90fc42a0e4376187935048e1a.png" src="_images/595e211a753e8eee39757b9217f3c68b1a4f23f90fc42a0e4376187935048e1a.png" />
<img alt="_images/2477486609d518488f99f72c0e6e67d866411ebc8f5fe48a1f0ae23c64c378e8.png" src="_images/2477486609d518488f99f72c0e6e67d866411ebc8f5fe48a1f0ae23c64c378e8.png" />
<img alt="_images/536fb3a663b384fe78bbb8e15bf36cdaa0c2a8dc758ede3f8e435087552fd262.png" src="_images/536fb3a663b384fe78bbb8e15bf36cdaa0c2a8dc758ede3f8e435087552fd262.png" />
</div>
</div>
<p><strong>Now performing co-relation between all the ordinal, nominal, continous columns and the other type of columns</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute correlation matrix</span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Visualize the correlation matrix</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Correlation Matrix&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Check for capped distributions (e.g., Age, YearsAtCompany)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="c1">#Feature Relationships:</span>
<span class="c1"># Analyze correlations for highly correlated features</span>
<span class="n">high_corr_features</span> <span class="o">=</span> <span class="n">correlation_matrix</span><span class="p">[</span>
    <span class="p">(</span><span class="n">correlation_matrix</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">correlation_matrix</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="p">]</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Highly Correlated Features:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">high_corr_features</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/aba75d4b0f3c5c6bc8219def26cff4d886b8b454bb006a6a0a02d24be05955ee.png" src="_images/aba75d4b0f3c5c6bc8219def26cff4d886b8b454bb006a6a0a02d24be05955ee.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>               Age  DistanceFromHome     JobLevel  EnvironmentSatisfaction  \
count  1470.000000       1470.000000  1470.000000              1470.000000   
mean     36.923810          9.192517     2.063946                 2.721769   
std       9.135373          8.106864     1.106940                 1.093082   
min      18.000000          1.000000     1.000000                 1.000000   
25%      30.000000          2.000000     1.000000                 2.000000   
50%      36.000000          7.000000     2.000000                 3.000000   
75%      43.000000         14.000000     3.000000                 4.000000   
max      60.000000         29.000000     5.000000                 4.000000   

       JobSatisfaction  WorkLifeBalance  StockOptionLevel  TotalWorkingYears  \
count      1470.000000      1470.000000       1470.000000        1470.000000   
mean          2.728571         2.761224          0.793878          11.279592   
std           1.102846         0.706476          0.852077           7.780782   
min           1.000000         1.000000          0.000000           0.000000   
25%           2.000000         2.000000          0.000000           6.000000   
50%           3.000000         3.000000          1.000000          10.000000   
75%           4.000000         3.000000          1.000000          15.000000   
max           4.000000         4.000000          3.000000          40.000000   

       YearsAtCompany  YearsInCurrentRole  NumCompaniesWorked  \
count     1470.000000         1470.000000         1470.000000   
mean         7.008163            4.229252            2.693197   
std          6.126525            3.623137            2.498009   
min          0.000000            0.000000            0.000000   
25%          3.000000            2.000000            1.000000   
50%          5.000000            3.000000            2.000000   
75%          9.000000            7.000000            4.000000   
max         40.000000           18.000000            9.000000   

       PercentSalaryHike    DailyRate  MonthlyIncome  
count        1470.000000  1470.000000    1470.000000  
mean           15.209524   802.485714    6502.931293  
std             3.659938   403.509100    4707.956783  
min            11.000000   102.000000    1009.000000  
25%            12.000000   465.000000    2911.000000  
50%            14.000000   802.000000    4919.000000  
75%            18.000000  1157.000000    8379.000000  
max            25.000000  1499.000000   19999.000000  
Highly Correlated Features:
JobLevel       MonthlyIncome    0.9503
MonthlyIncome  JobLevel         0.9503
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#From above all these analysis, it is identified that YearsAtCompany column and value of max_income will have to be reduced to below 17000.</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;MonthlyIncome&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">17000</span><span class="p">]</span>
<span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;YearsAtCompany&#39;</span><span class="p">,</span> <span class="s1">&#39;JobLevel&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Age</th>
      <th>Gender</th>
      <th>DistanceFromHome</th>
      <th>EducationField</th>
      <th>MaritalStatus</th>
      <th>JobRole</th>
      <th>Department</th>
      <th>EnvironmentSatisfaction</th>
      <th>JobSatisfaction</th>
      <th>WorkLifeBalance</th>
      <th>StockOptionLevel</th>
      <th>TotalWorkingYears</th>
      <th>YearsInCurrentRole</th>
      <th>NumCompaniesWorked</th>
      <th>PercentSalaryHike</th>
      <th>DailyRate</th>
      <th>MonthlyIncome</th>
      <th>Attrition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>41</td>
      <td>Female</td>
      <td>1</td>
      <td>Life Sciences</td>
      <td>Single</td>
      <td>Sales Executive</td>
      <td>Sales</td>
      <td>2</td>
      <td>4</td>
      <td>1</td>
      <td>0</td>
      <td>8</td>
      <td>4</td>
      <td>8</td>
      <td>11</td>
      <td>1102.0</td>
      <td>5993.0</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>1</th>
      <td>49</td>
      <td>Male</td>
      <td>8</td>
      <td>Life Sciences</td>
      <td>Married</td>
      <td>Research Scientist</td>
      <td>Research &amp; Development</td>
      <td>3</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>10</td>
      <td>7</td>
      <td>1</td>
      <td>23</td>
      <td>279.0</td>
      <td>5130.0</td>
      <td>No</td>
    </tr>
    <tr>
      <th>2</th>
      <td>37</td>
      <td>Male</td>
      <td>2</td>
      <td>Other</td>
      <td>Single</td>
      <td>Laboratory Technician</td>
      <td>Research &amp; Development</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>7</td>
      <td>0</td>
      <td>6</td>
      <td>15</td>
      <td>1373.0</td>
      <td>2090.0</td>
      <td>Yes</td>
    </tr>
    <tr>
      <th>3</th>
      <td>33</td>
      <td>Female</td>
      <td>3</td>
      <td>Life Sciences</td>
      <td>Married</td>
      <td>Research Scientist</td>
      <td>Research &amp; Development</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>8</td>
      <td>7</td>
      <td>1</td>
      <td>11</td>
      <td>1392.0</td>
      <td>2909.0</td>
      <td>No</td>
    </tr>
    <tr>
      <th>4</th>
      <td>27</td>
      <td>Male</td>
      <td>2</td>
      <td>Medical</td>
      <td>Married</td>
      <td>Laboratory Technician</td>
      <td>Research &amp; Development</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>6</td>
      <td>2</td>
      <td>9</td>
      <td>12</td>
      <td>591.0</td>
      <td>3468.0</td>
      <td>No</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#converting Nominal categorical data into numerical data</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;MaritalStatus&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="s1">&#39;Single&#39;</span><span class="p">,</span><span class="s1">&#39;Married&#39;</span><span class="p">,</span><span class="s1">&#39;Divorced&#39;</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Department&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="s1">&#39;Sales&#39;</span><span class="p">,</span><span class="s1">&#39;Research &amp; Development&#39;</span><span class="p">,</span><span class="s1">&#39;Human Resources&#39;</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;EducationField&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="s1">&#39;Life Sciences&#39;</span><span class="p">,</span><span class="s1">&#39;Medical&#39;</span><span class="p">,</span><span class="s1">&#39;Other&#39;</span><span class="p">,</span><span class="s1">&#39;Marketing&#39;</span><span class="p">,</span><span class="s1">&#39;Technical Degree&#39;</span><span class="p">,</span><span class="s1">&#39;Human Resources&#39;</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Gender&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="s1">&#39;Male&#39;</span><span class="p">,</span><span class="s1">&#39;Female&#39;</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;JobRole&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="s1">&#39;Sales Executive&#39;</span><span class="p">,</span><span class="s1">&#39;Research Scientist&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;Laboratory Technician&#39;</span><span class="p">,</span><span class="s1">&#39;Manufacturing Director&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;Healthcare Representative&#39;</span><span class="p">,</span><span class="s1">&#39;Manager&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;Sales Representative&#39;</span><span class="p">,</span><span class="s1">&#39;Research Director&#39;</span><span class="p">,</span><span class="s1">&#39;Human Resources&#39;</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Attrition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="s1">&#39;Yes&#39;</span><span class="p">,</span><span class="s1">&#39;No&#39;</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Age</th>
      <th>Gender</th>
      <th>DistanceFromHome</th>
      <th>EducationField</th>
      <th>MaritalStatus</th>
      <th>JobRole</th>
      <th>Department</th>
      <th>EnvironmentSatisfaction</th>
      <th>JobSatisfaction</th>
      <th>WorkLifeBalance</th>
      <th>StockOptionLevel</th>
      <th>TotalWorkingYears</th>
      <th>YearsInCurrentRole</th>
      <th>NumCompaniesWorked</th>
      <th>PercentSalaryHike</th>
      <th>DailyRate</th>
      <th>MonthlyIncome</th>
      <th>Attrition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>41</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>4</td>
      <td>1</td>
      <td>0</td>
      <td>8</td>
      <td>4</td>
      <td>8</td>
      <td>11</td>
      <td>1102.0</td>
      <td>5993.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>49</td>
      <td>1</td>
      <td>8</td>
      <td>1</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>10</td>
      <td>7</td>
      <td>1</td>
      <td>23</td>
      <td>279.0</td>
      <td>5130.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>37</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>3</td>
      <td>2</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>7</td>
      <td>0</td>
      <td>6</td>
      <td>15</td>
      <td>1373.0</td>
      <td>2090.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>33</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>8</td>
      <td>7</td>
      <td>1</td>
      <td>11</td>
      <td>1392.0</td>
      <td>2909.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>27</td>
      <td>1</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>6</td>
      <td>2</td>
      <td>9</td>
      <td>12</td>
      <td>591.0</td>
      <td>3468.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1465</th>
      <td>36</td>
      <td>1</td>
      <td>23</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>3</td>
      <td>1</td>
      <td>17</td>
      <td>2</td>
      <td>4</td>
      <td>17</td>
      <td>884.0</td>
      <td>2571.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1466</th>
      <td>39</td>
      <td>1</td>
      <td>6</td>
      <td>2</td>
      <td>2</td>
      <td>5</td>
      <td>2</td>
      <td>4</td>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>9</td>
      <td>7</td>
      <td>4</td>
      <td>15</td>
      <td>613.0</td>
      <td>9991.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1467</th>
      <td>27</td>
      <td>1</td>
      <td>4</td>
      <td>1</td>
      <td>2</td>
      <td>4</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>6</td>
      <td>2</td>
      <td>1</td>
      <td>20</td>
      <td>155.0</td>
      <td>6142.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1468</th>
      <td>49</td>
      <td>1</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>17</td>
      <td>6</td>
      <td>2</td>
      <td>14</td>
      <td>1023.0</td>
      <td>5390.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1469</th>
      <td>34</td>
      <td>1</td>
      <td>8</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>0</td>
      <td>6</td>
      <td>3</td>
      <td>2</td>
      <td>12</td>
      <td>628.0</td>
      <td>4404.0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>1373 rows Ã— 18 columns</p>
</div></div></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="experiment-1-creating-a-pre-processing-for-scaling-and-predicting">
<h1><strong>EXPERIMENT 1 Creating a pre-processing for scaling and predicting</strong><a class="headerlink" href="#experiment-1-creating-a-pre-processing-for-scaling-and-predicting" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">FunctionTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>

<span class="c1"># Set DagsHub credentials (replace with your username and token)</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lakshmisruthi2113&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fb625b8241fcd55ee2e320bfd8b24df629a66cec&quot;</span>

<span class="c1"># Split features and target</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Attrition&quot;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Attrition&quot;</span><span class="p">]</span>

<span class="c1"># Define preprocessing pipeline (only for numerical scaling)</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;int64&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
            <span class="p">(</span><span class="s2">&quot;minmax&quot;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>
            <span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="p">]),</span> <span class="n">numerical_features</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Define the full pipeline with Logistic Regression</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Cross-validation and hyperparameter tuning</span>
<span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
    <span class="n">pipeline</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;f1&quot;</span><span class="p">:</span> <span class="s2">&quot;f1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="s2">&quot;precision&quot;</span><span class="p">,</span>
        <span class="s2">&quot;recall&quot;</span><span class="p">:</span> <span class="s2">&quot;recall&quot;</span><span class="p">,</span>
        <span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="s2">&quot;accuracy&quot;</span>
    <span class="p">},</span>
    <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># Log results in MLFlow</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="s2">&quot;https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow&quot;</span><span class="p">)</span>  <span class="c1"># Replace with your DagsHub credentials</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Attrition prediction experiment 1&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;LogisticRegression&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="s2">&quot;StandardScaler + MinMaxScaler + LogTransformation&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;cross_validation&quot;</span><span class="p">,</span> <span class="s2">&quot;3-fold&quot;</span><span class="p">)</span>
    
    <span class="n">mean_f1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1&quot;</span><span class="p">])</span>
    <span class="n">std_f1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1&quot;</span><span class="p">])</span>
    
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;mean_f1&quot;</span><span class="p">,</span> <span class="n">mean_f1</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;std_f1&quot;</span><span class="p">,</span> <span class="n">std_f1</span><span class="p">)</span>
    
    <span class="c1"># Log model</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>

<span class="c1"># Output results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cross-validation results (3-fold):&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">cv_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Mean F1-score:&quot;</span><span class="p">,</span> <span class="n">mean_f1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Standard deviation of F1-score:&quot;</span><span class="p">,</span> <span class="n">std_f1</span><span class="p">)</span>

<span class="c1"># Confusion matrix on training data</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="n">conf_matrix</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Confusion Matrix:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">conf_matrix</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Classification Report:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/20 15:10:44 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ðŸƒ View run masked-conch-451 at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/0/runs/2d975dc7eb9d48f2acd9697ad2aacc91
ðŸ§ª View experiment at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/0
Cross-validation results (3-fold):
fit_time: [0.06682897 0.0456543  0.027596  ]
score_time: [0.01643944 0.         0.01614046]
test_f1: [0.91346154 0.91172914 0.91575092]
train_f1: [0.91325301 0.91494532 0.91404358]
test_precision: [0.84070796 0.84529148 0.85421412]
train_precision: [0.84315907 0.84988713 0.84736251]
test_recall: [1.         0.98950131 0.98684211]
train_recall: [0.99605782 0.99078947 0.99211564]
test_accuracy: [0.84279476 0.84061135 0.84901532]
train_accuracy: [0.84262295 0.84699454 0.84497817]

Mean F1-score: 0.9136471985625553
Standard deviation of F1-score: 0.0016471226094842523

Confusion Matrix:
[[  4  41]
 [  2 228]]

Classification Report:
              precision    recall  f1-score   support

           0       0.67      0.09      0.16        45
           1       0.85      0.99      0.91       230

    accuracy                           0.84       275
   macro avg       0.76      0.54      0.54       275
weighted avg       0.82      0.84      0.79       275
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="experiment-2-preprocessing-and-using-multiple-algorithms">
<h1><strong>EXPERIMENT 2: Preprocessing and Using Multiple Algorithms</strong><a class="headerlink" href="#experiment-2-preprocessing-and-using-multiple-algorithms" title="Link to this heading">#</a></h1>
<p>Experiment #2: Create a pipeline for preprocessing and use LogisticRegression, RidgeClassifier, RandomForestClassifier, and XGBClassifier. Log results in MLFlow on DagsHub.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">FunctionTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">RidgeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>

<span class="c1"># Set DagsHub credentials (replace with your username and token)</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lakshmisruthi2113&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fb625b8241fcd55ee2e320bfd8b24df629a66cec&quot;</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
            <span class="p">(</span><span class="s2">&quot;minmax&quot;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>
            <span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="p">]),</span> <span class="n">numerical_features</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Define classifiers</span>
<span class="n">classifiers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;LogisticRegression&quot;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
    <span class="s2">&quot;RidgeClassifier&quot;</span><span class="p">:</span> <span class="n">RidgeClassifier</span><span class="p">(),</span>
    <span class="s2">&quot;RandomForestClassifier&quot;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;XGBClassifier&quot;</span><span class="p">:</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">use_label_encoder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eval_metric</span><span class="o">=</span><span class="s2">&quot;logloss&quot;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Perform cross-validation and log results</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="s2">&quot;https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow&quot;</span><span class="p">)</span>  <span class="c1"># Replace with your DagsHub credentials</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Attrition prediction experiment 2&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">classifier</span><span class="p">)</span>
    <span class="p">])</span>

    <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
        <span class="n">pipeline</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">scoring</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;f1&quot;</span><span class="p">:</span> <span class="s2">&quot;f1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="s2">&quot;precision&quot;</span><span class="p">,</span>
            <span class="s2">&quot;recall&quot;</span><span class="p">:</span> <span class="s2">&quot;recall&quot;</span><span class="p">,</span>
            <span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="s2">&quot;accuracy&quot;</span>
        <span class="p">},</span>
        <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="s2">&quot;StandardScaler + MinMaxScaler + LogTransformation&quot;</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;cross_validation&quot;</span><span class="p">,</span> <span class="s2">&quot;3-fold&quot;</span><span class="p">)</span>
        
        <span class="n">mean_f1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1&quot;</span><span class="p">])</span>
        <span class="n">std_f1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1&quot;</span><span class="p">])</span>
        
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;mean_f1&quot;</span><span class="p">,</span> <span class="n">mean_f1</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;std_f1&quot;</span><span class="p">,</span> <span class="n">std_f1</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;mean_accuracy&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_accuracy&quot;</span><span class="p">]))</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;mean_precision&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_precision&quot;</span><span class="p">]))</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;mean_recall&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_recall&quot;</span><span class="p">]))</span>
        
        <span class="c1"># Log model</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Results for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean F1-score:&quot;</span><span class="p">,</span> <span class="n">mean_f1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Standard deviation of F1-score:&quot;</span><span class="p">,</span> <span class="n">std_f1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/20 15:10:57 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ðŸƒ View run blushing-flea-328 at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/1/runs/7bc1498f1da449b7980e2a4dd2587df6
ðŸ§ª View experiment at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/1
Results for LogisticRegression:
Mean F1-score: 0.9136471985625553
Standard deviation of F1-score: 0.0016471226094842523
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/20 15:11:15 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ðŸƒ View run luminous-steed-693 at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/1/runs/1681d53271ee4552b3376821cadedbb2
ðŸ§ª View experiment at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/1
Results for RidgeClassifier:
Mean F1-score: 0.9094658916480345
Standard deviation of F1-score: 0.0019728771578128115
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/20 15:11:32 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ðŸƒ View run defiant-jay-554 at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/1/runs/b2d7ef184cd84bb9b8cfe398ee728f33
ðŸ§ª View experiment at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/1
Results for RandomForestClassifier:
Mean F1-score: 0.9084945872945712
Standard deviation of F1-score: 0.0021806661637977943
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/20 15:11:50 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ðŸƒ View run debonair-penguin-787 at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/1/runs/a7333b077bef4e39a7a65938bafdabad
ðŸ§ª View experiment at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/1
Results for XGBClassifier:
Mean F1-score: 0.9010448559617918
Standard deviation of F1-score: 0.0016848415597721963
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="experiment-3-feature-engineering-and-attribute-combination">
<h1><strong>Experiment 3: feature engineering and attribute combination.</strong><a class="headerlink" href="#experiment-3-feature-engineering-and-attribute-combination" title="Link to this heading">#</a></h1>
<p>Experiment #3: Perform feature engineering and attribute combination. Log results in MLFlow.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">FunctionTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">RidgeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>

<span class="c1"># Set DagsHub credentials (replace with your username and token)</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lakshmisruthi2113&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fb625b8241fcd55ee2e320bfd8b24df629a66cec&quot;</span>

<span class="c1"># Feature engineering: Create new features</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;IncomePerYearWorked&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;MonthlyIncome&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TotalWorkingYears&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;SatisfactionIndex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;EnvironmentSatisfaction&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;JobSatisfaction&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;WorkLifeBalance&quot;</span><span class="p">]</span>
<span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>

<span class="c1"># Split features and target</span>
<span class="n">x_ex</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Attrition&quot;</span><span class="p">])</span>
<span class="n">y_ex</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Attrition&quot;</span><span class="p">]</span>

<span class="c1"># Define preprocessing pipeline (only for numerical scaling)</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">x_ex</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;int64&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
            <span class="p">(</span><span class="s2">&quot;minmax&quot;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>
            <span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="p">]),</span> <span class="n">numerical_features</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Define classifiers</span>
<span class="n">classifiers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;LogisticRegression&quot;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
    <span class="s2">&quot;RidgeClassifier&quot;</span><span class="p">:</span> <span class="n">RidgeClassifier</span><span class="p">(),</span>
    <span class="s2">&quot;RandomForestClassifier&quot;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;XGBClassifier&quot;</span><span class="p">:</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">use_label_encoder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eval_metric</span><span class="o">=</span><span class="s2">&quot;logloss&quot;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Perform cross-validation and log results</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="s2">&quot;https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow&quot;</span><span class="p">)</span>  <span class="c1"># Replace with your DagsHub credentials</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Attrition Prediction Experiment 3&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">classifier</span><span class="p">)</span>
    <span class="p">])</span>

    <span class="n">cv_results</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span>
        <span class="n">pipeline</span><span class="p">,</span> <span class="n">x_ex</span><span class="p">,</span> <span class="n">y_ex</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">scoring</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;f1&quot;</span><span class="p">:</span> <span class="s2">&quot;f1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="s2">&quot;precision&quot;</span><span class="p">,</span>
            <span class="s2">&quot;recall&quot;</span><span class="p">:</span> <span class="s2">&quot;recall&quot;</span><span class="p">,</span>
            <span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="s2">&quot;accuracy&quot;</span>
        <span class="p">},</span>
        <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="s2">&quot;StandardScaler + MinMaxScaler + LogTransformation&quot;</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;cross_validation&quot;</span><span class="p">,</span> <span class="s2">&quot;3-fold&quot;</span><span class="p">)</span>
        
        <span class="n">mean_f1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1&quot;</span><span class="p">])</span>
        <span class="n">std_f1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_f1&quot;</span><span class="p">])</span>
        
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;mean_f1&quot;</span><span class="p">,</span> <span class="n">mean_f1</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;std_f1&quot;</span><span class="p">,</span> <span class="n">std_f1</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;mean_accuracy&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_accuracy&quot;</span><span class="p">]))</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;mean_precision&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_precision&quot;</span><span class="p">]))</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;mean_recall&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_recall&quot;</span><span class="p">]))</span>
        
        <span class="c1"># Log model</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Results for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean F1-score:&quot;</span><span class="p">,</span> <span class="n">mean_f1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Standard deviation of F1-score:&quot;</span><span class="p">,</span> <span class="n">std_f1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/20 15:12:08 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ðŸƒ View run vaunted-squirrel-805 at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/2/runs/4d656f57127b44b8a2bf3ea190312722
ðŸ§ª View experiment at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/2
Results for LogisticRegression:
Mean F1-score: 0.9143815385631453
Standard deviation of F1-score: 0.0011979853926774562
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/20 15:12:27 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ðŸƒ View run sedate-newt-491 at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/2/runs/7a168fbe71c34c7e96575a8314ef1482
ðŸ§ª View experiment at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/2
Results for RidgeClassifier:
Mean F1-score: 0.9106254604997465
Standard deviation of F1-score: 0.0011741480335745644
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/20 15:12:44 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ðŸƒ View run stylish-snail-753 at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/2/runs/3ea7bc96488743e7a606630e5315f1af
ðŸ§ª View experiment at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/2
Results for RandomForestClassifier:
Mean F1-score: 0.9120387165947553
Standard deviation of F1-score: 0.0011050572584650358
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/20 15:13:02 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ðŸƒ View run vaunted-auk-305 at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/2/runs/31e5993bdf204b57918a396776a5cc6e
ðŸ§ª View experiment at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/2
Results for XGBClassifier:
Mean F1-score: 0.9056187030636776
Standard deviation of F1-score: 0.00613905084023977
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="experiment-4-feature-selection-feature-importance-variance-threshold">
<h1><strong>EXPERIMENT 4: Feature Selection, Feature Importance, Variance Threshold</strong><a class="headerlink" href="#experiment-4-feature-selection-feature-importance-variance-threshold" title="Link to this heading">#</a></h1>
<p>Experiment #4: Perform feature selection using Correlation Threshold, Feature Importance, and Variance Threshold. Log results in MLFlow.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">FunctionTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">VarianceThreshold</span><span class="p">,</span> <span class="n">SelectKBest</span><span class="p">,</span> <span class="n">f_classif</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>

<span class="c1"># Set DagsHub credentials (replace with your username and token)</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lakshmisruthi2113&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fb625b8241fcd55ee2e320bfd8b24df629a66cec&quot;</span>

<span class="c1"># Feature Selection: Variance Threshold</span>
<span class="n">variance_selector</span> <span class="o">=</span> <span class="n">VarianceThreshold</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">X_var</span> <span class="o">=</span> <span class="n">variance_selector</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">selected_features_var</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">variance_selector</span><span class="o">.</span><span class="n">get_support</span><span class="p">()]</span>

<span class="c1"># Feature Selection: Correlation Threshold</span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">high_corr_pairs</span> <span class="o">=</span> <span class="n">correlation_matrix</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">high_corr_pairs</span> <span class="o">=</span> <span class="n">high_corr_pairs</span><span class="p">[</span><span class="n">high_corr_pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">]</span>
<span class="n">high_corr_pairs</span> <span class="o">=</span> <span class="n">high_corr_pairs</span><span class="p">[</span><span class="n">high_corr_pairs</span><span class="p">[</span><span class="s1">&#39;level_0&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">high_corr_pairs</span><span class="p">[</span><span class="s1">&#39;level_1&#39;</span><span class="p">]]</span>
<span class="n">high_corr_pairs</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;high_correlation_features.csv&quot;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1"># Feature Selection: SelectKBest</span>
<span class="n">select_k_best</span> <span class="o">=</span> <span class="n">SelectKBest</span><span class="p">(</span><span class="n">score_func</span><span class="o">=</span><span class="n">f_classif</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">X_kbest</span> <span class="o">=</span> <span class="n">select_k_best</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">selected_features_kbest</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">select_k_best</span><span class="o">.</span><span class="n">get_support</span><span class="p">()]</span>

<span class="c1"># Log selected features in MLFlow</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="s2">&quot;https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow&quot;</span><span class="p">)</span>  <span class="c1"># Replace with your DagsHub credentials</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Attrition Prediction Experiment 4&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;feature_selection_method&quot;</span><span class="p">,</span> <span class="s2">&quot;Variance, Correlation, SelectKBest&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;variance_threshold&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">selected_features_var</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;k_best_features&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">selected_features_kbest</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;num_variance_selected_features&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_features_var</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;num_k_best_features&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_features_kbest</span><span class="p">))</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;high_correlation_features.csv&quot;</span><span class="p">)</span>  <span class="c1"># Log correlation pairs if needed</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Variance Threshold Selected Features:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">selected_features_var</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">SelectKBest Features:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">selected_features_kbest</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Variance Threshold Selected Features:
Index([&#39;Age&#39;, &#39;Gender&#39;, &#39;DistanceFromHome&#39;, &#39;EducationField&#39;, &#39;MaritalStatus&#39;,
       &#39;JobRole&#39;, &#39;Department&#39;, &#39;EnvironmentSatisfaction&#39;, &#39;JobSatisfaction&#39;,
       &#39;WorkLifeBalance&#39;, &#39;StockOptionLevel&#39;, &#39;TotalWorkingYears&#39;,
       &#39;YearsInCurrentRole&#39;, &#39;NumCompaniesWorked&#39;, &#39;PercentSalaryHike&#39;,
       &#39;DailyRate&#39;, &#39;MonthlyIncome&#39;],
      dtype=&#39;object&#39;)

SelectKBest Features:
Index([&#39;Age&#39;, &#39;DistanceFromHome&#39;, &#39;EducationField&#39;, &#39;MaritalStatus&#39;,
       &#39;EnvironmentSatisfaction&#39;, &#39;JobSatisfaction&#39;, &#39;StockOptionLevel&#39;,
       &#39;TotalWorkingYears&#39;, &#39;YearsInCurrentRole&#39;, &#39;MonthlyIncome&#39;],
      dtype=&#39;object&#39;)
ðŸƒ View run nimble-bass-362 at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/3/runs/c9828074baa14755b9281f8422cb4cb2
ðŸ§ª View experiment at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/3
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="experiment-5-applying-pca">
<h1><strong>EXPERIMENT 5: Applying PCA</strong><a class="headerlink" href="#experiment-5-applying-pca" title="Link to this heading">#</a></h1>
<p>Experiment #5: Use PCA for dimensionality reduction on all the features. Create a scree plot to show which components will be selected for classification. Log results in MLFlow.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">FunctionTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>

<span class="c1"># Set DagsHub credentials (replace with your username and token)</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lakshmisruthi2113&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fb625b8241fcd55ee2e320bfd8b24df629a66cec&quot;</span>

<span class="c1"># Preprocessing pipeline</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;int64&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
            <span class="p">(</span><span class="s2">&quot;minmax&quot;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>
            <span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="p">]),</span> <span class="n">numerical_features</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Apply PCA</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;pca&quot;</span><span class="p">,</span> <span class="n">pca</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Fit PCA to the data</span>
<span class="n">X_pca</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">explained_variance</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>

<span class="c1"># Scree plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">explained_variance</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">explained_variance</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Explained Variance by Principal Components&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of Components&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cumulative Explained Variance&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Determine the number of components to retain</span>
<span class="n">cumulative_variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">explained_variance</span><span class="p">)</span>
<span class="n">n_components</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">cumulative_variance</span> <span class="o">&gt;=</span> <span class="mf">0.95</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Retain components explaining 95% variance</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of components to retain: </span><span class="si">{</span><span class="n">n_components</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Log results in MLFlow</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="s2">&quot;https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow&quot;</span><span class="p">)</span>  <span class="c1"># Replace with your DagsHub credentials</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Attrition Prediction Experiment #5&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;dimensionality_reduction&quot;</span><span class="p">,</span> <span class="s2">&quot;PCA&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">variance</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">explained_variance</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;explained_variance_ratio_component_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">variance</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;cumulative_variance_95_components&quot;</span><span class="p">,</span> <span class="n">n_components</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Explained Variance Ratio:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">explained_variance</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Number of Components to Retain:&quot;</span><span class="p">,</span> <span class="n">n_components</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d2602e4a1f479a422bdb5b795514b27f703fa60b74c96b2787fe6bc7cc7f1050.png" src="_images/d2602e4a1f479a422bdb5b795514b27f703fa60b74c96b2787fe6bc7cc7f1050.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of components to retain: 14
Explained Variance Ratio:
[0.15573991 0.13161896 0.08688641 0.08340954 0.08091522 0.0742552
 0.05912626 0.05781413 0.05208112 0.049508   0.04737032 0.03454581
 0.02891146 0.02060526 0.01827814 0.01389751 0.00503675]

Number of Components to Retain: 14
ðŸƒ View run unleashed-hawk-298 at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/5/runs/73cca7e094b04053a1a5dc879cdfa7da
ðŸ§ª View experiment at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/5
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="experiment-6-creating-a-custom-experiment">
<h1><strong>EXPERIMENT 6: Creating a custom experiment</strong><a class="headerlink" href="#experiment-6-creating-a-custom-experiment" title="Link to this heading">#</a></h1>
<p><strong>In this custom experiment, I have implemented decision tree</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span>

<span class="c1"># Set DagsHub credentials (replace with your username and token)</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lakshmisruthi2113&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fb625b8241fcd55ee2e320bfd8b24df629a66cec&quot;</span>

<span class="c1"># Feature engineering: Custom engineered features</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;IncomePerYearWorked&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;MonthlyIncome&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TotalWorkingYears&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;SatisfactionIndex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;EnvironmentSatisfaction&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;JobSatisfaction&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;WorkLifeBalance&quot;</span><span class="p">]</span>
<span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>

<span class="c1"># Split features and target</span>
<span class="n">x_ex6</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Attrition&quot;</span><span class="p">])</span>
<span class="n">y_ex6</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Attrition&quot;</span><span class="p">]</span>

<span class="c1"># Preprocessing pipeline</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">x_ex6</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;int64&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
            <span class="p">(</span><span class="s2">&quot;minmax&quot;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>
            <span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="p">]),</span> <span class="n">numerical_features</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Custom Experiment: Combine Logistic Regression with Feature Scaling and Custom Features</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Train-test split</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">x_ex6</span><span class="p">,</span> <span class="n">y_ex6</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Fit and evaluate the model</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Metrics</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">precision</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">recall</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="c1"># Log results in MLFlow</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="s2">&quot;https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow&quot;</span><span class="p">)</span>  <span class="c1"># Replace with your DagsHub credentials</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Attrition Prediction Experiment 6&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;LogisticRegression&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;scaling&quot;</span><span class="p">,</span> <span class="s2">&quot;StandardScaler + MinMaxScaler + LogTransformation&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;precision&quot;</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;recall&quot;</span><span class="p">,</span> <span class="n">recall</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Custom Experiment Results:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1 Score: </span><span class="si">{</span><span class="n">f1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Precision: </span><span class="si">{</span><span class="n">precision</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recall: </span><span class="si">{</span><span class="n">recall</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy: </span><span class="si">{</span><span class="n">accuracy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Custom Experiment Results:
F1 Score: 0.8269662921348315
Precision: 0.8558139534883721
Recall: 0.8
Accuracy: 0.72
ðŸƒ View run capable-fish-816 at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/6/runs/126fa1a9daea41a69c4f12d05d0402da
ðŸ§ª View experiment at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/6
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="experiment-7-another-custom-experiment">
<h1><strong>EXPERIMENT 7: Another custom experiment</strong><a class="headerlink" href="#experiment-7-another-custom-experiment" title="Link to this heading">#</a></h1>
<p><strong>In this custom experiment Iâ€™m using KNN classifier</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span>

<span class="c1"># Set DagsHub credentials (replace with your username and token)</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_USERNAME&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lakshmisruthi2113&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MLFLOW_TRACKING_PASSWORD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fb625b8241fcd55ee2e320bfd8b24df629a66cec&quot;</span>

<span class="c1"># Feature engineering: Custom engineered features</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;IncomePerYearWorked&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;MonthlyIncome&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;TotalWorkingYears&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;SatisfactionIndex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;EnvironmentSatisfaction&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;JobSatisfaction&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;WorkLifeBalance&quot;</span><span class="p">]</span>
<span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>

<span class="c1"># Split features and target</span>
<span class="n">x_ex6</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Attrition&quot;</span><span class="p">])</span>
<span class="n">y_ex6</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Attrition&quot;</span><span class="p">]</span>

<span class="c1"># Preprocessing pipeline</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">x_ex6</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;int64&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
            <span class="p">(</span><span class="s2">&quot;minmax&quot;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>
            <span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="p">]),</span> <span class="n">numerical_features</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Custom Experiment: Combine Logistic Regression with Feature Scaling and Custom Features</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">leaf_size</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Train-test split</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">x_ex6</span><span class="p">,</span> <span class="n">y_ex6</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Fit and evaluate the model</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Metrics</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">precision</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">recall</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="c1"># Log results in MLFlow</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="s2">&quot;https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow&quot;</span><span class="p">)</span>  <span class="c1"># Replace with your DagsHub credentials</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Attrition Prediction Experiment 7&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;LogisticRegression&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;scaling&quot;</span><span class="p">,</span> <span class="s2">&quot;StandardScaler + MinMaxScaler + LogTransformation&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;precision&quot;</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;recall&quot;</span><span class="p">,</span> <span class="n">recall</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Custom Experiment Results:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1 Score: </span><span class="si">{</span><span class="n">f1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Precision: </span><span class="si">{</span><span class="n">precision</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recall: </span><span class="si">{</span><span class="n">recall</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy: </span><span class="si">{</span><span class="n">accuracy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Custom Experiment Results:
F1 Score: 0.9101796407185629
Precision: 0.8413284132841329
Recall: 0.991304347826087
Accuracy: 0.8363636363636363
ðŸƒ View run hilarious-bee-252 at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/7/runs/97cf380262034a5d9926e684c7850e63
ðŸ§ª View experiment at: https://dagshub.com/lakshmisruthi2113/my-first-repo.mlflow/#/experiments/7
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="step-8-f1-scores-of-all-models">
<h1><strong>STEP 8: F1 Scores of all models</strong><a class="headerlink" href="#step-8-f1-scores-of-all-models" title="Link to this heading">#</a></h1>
<p>Writing out of all f1 scores of every models, and comparing which one is performing better.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f1_scores_exp</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Logistic Regression&quot;</span><span class="p">:</span> <span class="mf">0.9143</span><span class="p">,</span>
    <span class="s2">&quot;Ridge Classifier&quot;</span><span class="p">:</span> <span class="mf">0.9106</span><span class="p">,</span>
    <span class="s2">&quot;Random Forest Classifier&quot;</span><span class="p">:</span> <span class="mf">0.9084</span><span class="p">,</span>
    <span class="s2">&quot;XGBoost&quot;</span><span class="p">:</span> <span class="mf">0.9010</span><span class="p">,</span>
    <span class="s2">&quot;Decision Tree&quot;</span><span class="p">:</span> <span class="mf">0.82</span><span class="p">,</span>
    <span class="s2">&quot;K Neighbors Classifier&quot;</span><span class="p">:</span> <span class="mf">0.91</span>
<span class="p">}</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">f1_scores_exp</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">f1_scores_exp</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;F-1 Scores of every model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Experiment Model name&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;F-1 Score&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#Based on the analysis, logistic regression and K Neigbors classfier are best overall performing models among all others.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d2faaf90a21e24b8e28bf59300cf1ba01093be9a0f5ba1409d389e91d622bc2f.png" src="_images/d2faaf90a21e24b8e28bf59300cf1ba01093be9a0f5ba1409d389e91d622bc2f.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="step-9-creation-of-fastapi-for-model-and-streamlit-app">
<h1><strong>Step 9: Creation of FastAPI for model and Streamlit APP</strong><a class="headerlink" href="#step-9-creation-of-fastapi-for-model-and-streamlit-app" title="Link to this heading">#</a></h1>
<p>Now saving the model using joblib and that model will serve as predictions whether the employee is willing to leave the company or not. Also, a streamlit app is created in order to make predictions directly in the webpage with the new unseen data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Age</th>
      <th>Gender</th>
      <th>DistanceFromHome</th>
      <th>EducationField</th>
      <th>MaritalStatus</th>
      <th>JobRole</th>
      <th>Department</th>
      <th>EnvironmentSatisfaction</th>
      <th>JobSatisfaction</th>
      <th>WorkLifeBalance</th>
      <th>StockOptionLevel</th>
      <th>TotalWorkingYears</th>
      <th>YearsInCurrentRole</th>
      <th>NumCompaniesWorked</th>
      <th>PercentSalaryHike</th>
      <th>DailyRate</th>
      <th>MonthlyIncome</th>
      <th>Attrition</th>
      <th>IncomePerYearWorked</th>
      <th>SatisfactionIndex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>41</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>4</td>
      <td>1</td>
      <td>0</td>
      <td>8</td>
      <td>4</td>
      <td>8</td>
      <td>11</td>
      <td>1102.0</td>
      <td>5993.0</td>
      <td>0</td>
      <td>665.888889</td>
      <td>2.333333</td>
    </tr>
    <tr>
      <th>1</th>
      <td>49</td>
      <td>1</td>
      <td>8</td>
      <td>1</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>10</td>
      <td>7</td>
      <td>1</td>
      <td>23</td>
      <td>279.0</td>
      <td>5130.0</td>
      <td>1</td>
      <td>466.363636</td>
      <td>2.666667</td>
    </tr>
    <tr>
      <th>2</th>
      <td>37</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>3</td>
      <td>2</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>7</td>
      <td>0</td>
      <td>6</td>
      <td>15</td>
      <td>1373.0</td>
      <td>2090.0</td>
      <td>0</td>
      <td>261.250000</td>
      <td>3.333333</td>
    </tr>
    <tr>
      <th>3</th>
      <td>33</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>0</td>
      <td>8</td>
      <td>7</td>
      <td>1</td>
      <td>11</td>
      <td>1392.0</td>
      <td>2909.0</td>
      <td>1</td>
      <td>323.222222</td>
      <td>3.333333</td>
    </tr>
    <tr>
      <th>4</th>
      <td>27</td>
      <td>1</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>6</td>
      <td>2</td>
      <td>9</td>
      <td>12</td>
      <td>591.0</td>
      <td>3468.0</td>
      <td>1</td>
      <td>495.428571</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1465</th>
      <td>36</td>
      <td>1</td>
      <td>23</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>3</td>
      <td>1</td>
      <td>17</td>
      <td>2</td>
      <td>4</td>
      <td>17</td>
      <td>884.0</td>
      <td>2571.0</td>
      <td>1</td>
      <td>142.833333</td>
      <td>3.333333</td>
    </tr>
    <tr>
      <th>1466</th>
      <td>39</td>
      <td>1</td>
      <td>6</td>
      <td>2</td>
      <td>2</td>
      <td>5</td>
      <td>2</td>
      <td>4</td>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>9</td>
      <td>7</td>
      <td>4</td>
      <td>15</td>
      <td>613.0</td>
      <td>9991.0</td>
      <td>1</td>
      <td>999.100000</td>
      <td>2.666667</td>
    </tr>
    <tr>
      <th>1467</th>
      <td>27</td>
      <td>1</td>
      <td>4</td>
      <td>1</td>
      <td>2</td>
      <td>4</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>6</td>
      <td>2</td>
      <td>1</td>
      <td>20</td>
      <td>155.0</td>
      <td>6142.0</td>
      <td>1</td>
      <td>877.428571</td>
      <td>2.333333</td>
    </tr>
    <tr>
      <th>1468</th>
      <td>49</td>
      <td>1</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>17</td>
      <td>6</td>
      <td>2</td>
      <td>14</td>
      <td>1023.0</td>
      <td>5390.0</td>
      <td>1</td>
      <td>299.444444</td>
      <td>2.666667</td>
    </tr>
    <tr>
      <th>1469</th>
      <td>34</td>
      <td>1</td>
      <td>8</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>0</td>
      <td>6</td>
      <td>3</td>
      <td>2</td>
      <td>12</td>
      <td>628.0</td>
      <td>4404.0</td>
      <td>1</td>
      <td>629.142857</td>
      <td>3.000000</td>
    </tr>
  </tbody>
</table>
<p>1373 rows Ã— 20 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Before creating a streamlit app, data is retrieved.</span>
<span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Unnamed: 0&quot;</span><span class="p">,</span> <span class="s2">&quot;IncomePerYearWorked&quot;</span><span class="p">,</span> <span class="s2">&quot;SatisfactionIndex&quot;</span><span class="p">],</span> <span class="n">errors</span> <span class="o">=</span> <span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;data_final.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> app.py
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">FunctionTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">import</span> <span class="nn">joblib</span>

<span class="c1"># Load the dataset</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;C:/Users/anchu/ML_Project_Python/datasets/data_final.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Drop unnecessary columns</span>
<span class="n">columns_to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;IncomePerYearWorked&quot;</span><span class="p">,</span> <span class="s2">&quot;SatisfactionIndex&quot;</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns_to_drop</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="c1"># Split features and target</span>
<span class="n">x_final</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Attrition&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">y_final</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Attrition&quot;</span><span class="p">]</span>

<span class="c1"># Identify numerical and categorical features</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">x_final</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;int64&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># Safe log transformation</span>
<span class="k">def</span> <span class="nf">safe_log_transform</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Preprocessing pipeline</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
            <span class="p">(</span><span class="s2">&quot;minmax&quot;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">()),</span>
            <span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">safe_log_transform</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="p">]),</span> <span class="n">numerical_features</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Classifier pipeline</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;minkowski&#39;</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Train-test split</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">x_final</span><span class="p">,</span> <span class="n">y_final</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Fit the model</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Save the model using joblib</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;attrition_model.joblib&quot;</span><span class="p">)</span>

<span class="c1"># FastAPI application</span>
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="c1"># Load the model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;attrition_model.joblib&quot;</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/predict&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">input_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Endpoint to make predictions.&quot;&quot;&quot;</span>
    <span class="n">input_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">input_data</span><span class="p">])</span>

    <span class="c1"># Convert categorical fields to numeric manually</span>
    <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;Gender&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;Gender&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;Male&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Female&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
    <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;EducationField&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;EducationField&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;Life Sciences&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Medical&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Marketing&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Technical Degree&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Other&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">})</span>
    <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;MaritalStatus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;MaritalStatus&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;Single&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Married&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Divorced&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
    <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;JobRole&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;JobRole&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;Sales Executive&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Research Scientist&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Laboratory Technician&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Manager&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Sales Representative&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Research Director&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;Human Resources&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;Healthcare Representative&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;Manufacturing Director&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>
    <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;Department&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;Department&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;Sales&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Research &amp; Development&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Human Resources&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>

    <span class="c1"># Validate input data</span>
    <span class="n">input_df</span> <span class="o">=</span> <span class="n">input_df</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">processed_input</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">input_df</span><span class="p">)</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;classifier&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">processed_input</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;prediction&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">])}</span>

<span class="c1">##########################################</span>
<span class="c1"># Streamlit App</span>
<span class="kn">import</span> <span class="nn">streamlit</span> <span class="k">as</span> <span class="nn">st</span>

<span class="n">st</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Employee Attrition Prediction&quot;</span><span class="p">)</span>

<span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Provide the following details to predict employee attrition:&quot;</span><span class="p">)</span>

<span class="c1"># Input fields</span>
<span class="n">input_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Age&quot;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;Gender&quot;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s2">&quot;Gender&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Male&quot;</span><span class="p">,</span> <span class="s2">&quot;Female&quot;</span><span class="p">]),</span>
    <span class="s2">&quot;DistanceFromHome&quot;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Distance From Home&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;EducationField&quot;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s2">&quot;Education Field&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Life Sciences&quot;</span><span class="p">,</span> <span class="s2">&quot;Medical&quot;</span><span class="p">,</span> <span class="s2">&quot;Marketing&quot;</span><span class="p">,</span> <span class="s2">&quot;Technical Degree&quot;</span><span class="p">,</span> <span class="s2">&quot;Other&quot;</span><span class="p">]),</span>
    <span class="s2">&quot;MaritalStatus&quot;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s2">&quot;Marital Status&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Single&quot;</span><span class="p">,</span> <span class="s2">&quot;Married&quot;</span><span class="p">,</span> <span class="s2">&quot;Divorced&quot;</span><span class="p">]),</span>
    <span class="s2">&quot;JobRole&quot;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s2">&quot;Job Role&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Sales Executive&quot;</span><span class="p">,</span> <span class="s2">&quot;Research Scientist&quot;</span><span class="p">,</span> <span class="s2">&quot;Laboratory Technician&quot;</span><span class="p">,</span> <span class="s2">&quot;Manager&quot;</span><span class="p">,</span> <span class="s2">&quot;Sales Representative&quot;</span><span class="p">,</span> <span class="s2">&quot;Research Director&quot;</span><span class="p">,</span> <span class="s2">&quot;Human Resources&quot;</span><span class="p">,</span> <span class="s2">&quot;Healthcare Representative&quot;</span><span class="p">,</span> <span class="s2">&quot;Manufacturing Director&quot;</span><span class="p">]),</span>
    <span class="s2">&quot;Department&quot;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">selectbox</span><span class="p">(</span><span class="s2">&quot;Department&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Sales&quot;</span><span class="p">,</span> <span class="s2">&quot;Research &amp; Development&quot;</span><span class="p">,</span> <span class="s2">&quot;Human Resources&quot;</span><span class="p">]),</span>
    <span class="s2">&quot;JobLevel&quot;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Job Level&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;EnvironmentSatisfaction&quot;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Environment Satisfaction&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;JobSatisfaction&quot;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Job Satisfaction&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;WorkLifeBalance&quot;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Work Life Balance&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;StockOptionLevel&quot;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Stock Option Level&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;TotalWorkingYears&quot;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Total Working Years&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;YearsInCurrentRole&quot;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Years in Current Role&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;NumCompaniesWorked&quot;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Number of Companies Worked&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;PercentSalaryHike&quot;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Percent Salary Hike&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;DailyRate&quot;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Daily Rate&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;MonthlyIncome&quot;</span><span class="p">:</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Monthly Income&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;Predict Attrition&quot;</span><span class="p">):</span>
    <span class="n">input_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">input_data</span><span class="p">])</span>

    <span class="c1"># Convert categorical fields to numeric manually</span>
    <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;Gender&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;Gender&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;Male&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Female&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
    <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;EducationField&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;EducationField&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;Life Sciences&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Medical&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Marketing&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Technical Degree&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Other&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">})</span>
    <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;MaritalStatus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;MaritalStatus&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;Single&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Married&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Divorced&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
    <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;JobRole&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;JobRole&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;Sales Executive&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Research Scientist&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Laboratory Technician&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Manager&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Sales Representative&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Research Director&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;Human Resources&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;Healthcare Representative&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;Manufacturing Director&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">})</span>
    <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;Department&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;Department&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;Sales&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Research &amp; Development&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Human Resources&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>

    <span class="c1"># Validate input data</span>
    <span class="n">input_df</span> <span class="o">=</span> <span class="n">input_df</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">processed_input</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">input_df</span><span class="p">)</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;classifier&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">processed_input</span><span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Prediction: &quot;</span><span class="p">,</span> <span class="s2">&quot;Employee is not willing to leave the company.&quot;</span> <span class="k">if</span> <span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;Employee is likely to leave.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting app.py
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="markdown.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Introduction</p>
      </div>
    </a>
    <a class="right-next"
       href="resume.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Anchula Lakshmi Sruthi</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Employee Attrition Prediction</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-creating-a-normalized-database-3nf-using-sqlite"><strong>STEP 1: Creating a Normalized Database (3NF) using SQLITE</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-exploring-the-data-train-test-split"><strong>STEP 2: Exploring the data, train test split</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-exploring-the-data-and-performing-analysis"><strong>STEP 3: Exploring the data and performing analysis</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-1-creating-a-pre-processing-for-scaling-and-predicting"><strong>EXPERIMENT 1 Creating a pre-processing for scaling and predicting</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-2-preprocessing-and-using-multiple-algorithms"><strong>EXPERIMENT 2: Preprocessing and Using Multiple Algorithms</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-3-feature-engineering-and-attribute-combination"><strong>Experiment 3: feature engineering and attribute combination.</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-4-feature-selection-feature-importance-variance-threshold"><strong>EXPERIMENT 4: Feature Selection, Feature Importance, Variance Threshold</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-5-applying-pca"><strong>EXPERIMENT 5: Applying PCA</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-6-creating-a-custom-experiment"><strong>EXPERIMENT 6: Creating a custom experiment</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-7-another-custom-experiment"><strong>EXPERIMENT 7: Another custom experiment</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#step-8-f1-scores-of-all-models"><strong>STEP 8: F1 Scores of all models</strong></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#step-9-creation-of-fastapi-for-model-and-streamlit-app"><strong>Step 9: Creation of FastAPI for model and Streamlit APP</strong></a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Anchula Lakshmi Sruthi
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>